name: people
type: magicservice
organisation: magicbutton
magicappversion: v0.0.1
description: A simple app to manage users, groups and memberships

baseattributes:
  record:
    &recordAttributes # Id + Created + Updated + CreatedBy + UpdatedBy are implicit
    - name: tenant
      type: string
      required: true
    - name: name
      type: string
      required: true
    - name: description
      type: string
      required: false

entities:
  group: &group
    name: group
    description: Group
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: hidden
        type: boolean
        required: false
      - name: notesid
        type: string
        required: true
  country: &country
    name: country
    description: Country
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: code
        type: string
        required: true
  company: &company
    name: company
    description: Company
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: vatnumber
        type: string
        required: true
      - name: phonenumber
        type: string
        required: false
      - name: address
        type: string
        required: false
      - name: city
        type: string
        required: false
      - name: postalcode
        type: string
        required: false
      - name: country
        type: reference
        entity: *country
        required: false
  system: &system
    name: system
    description: System
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: version
        type: string
        required: true

  user: &user
    name: user
    description: User
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: system
        type: reference
        entity: *system
        required: true
      - name: fullname
        type: string
        required: true
  relation: &relation
    name: relation
    description: Relation
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: relation
        type: reference
        entity: *company
        required: false
      - name: relationtype
        type: string
        required: false
      - name: groups
        type: array
        entity: *group

  person: &person
    name: person
    description: Person
    baselineattributes: *recordAttributes
    additionalattributes:
      - name: email
        type: string
        required: true
      - name: firstname
        type: string
        required: true
      - name: lastname
        type: string
        required: true
      - name: phonenumber
        type: string
        required: false
      - name: governmentid
        type: string
        required: false
      - name: users
        type: array
        entity: *relation
        required: false

models:
  itemMethods: &itemMethods
    - name: read
      description: Read a single item
      parameters:
        - name: id
          description: The id of the item
          type: int64
          required: true
      returns:
        type: object

    - name: create
      description: Create a new item
      parameters:
        - name: item
          description: The item to create
          type: object
          required: true
      returns:
        type: object
    - name: update
      description: Update an existing item
      parameters:
        - name: item
          description: The item to update
          type: object
          required: true
      returns:
        type: object

    - name: delete
      description: Delete an existing item
      parameters:
        - name: id
          description: The id of the item
          type: int64
          required: true
      returns:
        type: void
    - name: search
      description: Search for items
      parameters:
        - name: query
          description: The search query
          type: string
          required: true

      returns:
        type: page

services:
  - name: user
    description: Manage users
    entity:
      type: record
      model: user
      objectname: User
      entity: *user
    methods: *itemMethods

  - name: group
    description: Manage Groups
    entity:
      type: record
      model: group
      objectname: Group
      entity: *group
    methods: *itemMethods
